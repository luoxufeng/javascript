<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>监听对象中属性的变化</title>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/jquery-1.10.2.js"></script>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/underscore.js"></script>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/backbone.js"></script>
</head>
    <body>
        <p>假设你有在对象的某个属性发生变化时去处理一些业务的话，下面的示例会有帮助。依然是定义那个类，不同的是我们在构造函数中绑定了name属性的change事件。这样当name发生变化是，就会触发这个function。</p>
        <script type="text/javascript">
            (function ($) {
                var Man = Backbone.Model.extend({
                    initialize: function () {
                        alert('Hey, you create me!');
                        //初始化时绑定监听, change事件会先于validate发生
                        this.bind("change:name", function () {
                            var name = this.get("name");
                            alert("你改变了name属性为：" + name);
                        });
                        this.bind("invalid", function (model, error) {
                            alert(error);
                        });
                    },
                    defaults: {
                        name: '张三',
                        age: '38'
                    },
                    validate: function (attributes) {
                        if (attributes.name == '') {
                            return "name不能为空！";
                        }
                    },
                    aboutMe: function () {
                        return '我叫' + this.get('name') + ',今年' + this.get('age') + '岁';
                    }
                });
                var man = new Man;
                // 这种方式添加错误处理也行
                // man.on('invalid', function(model, error){
                //         alert(error);
                // });

                man.set({ name: '1111' }); //默认set时不进行验证
                man.set({name:'222'});
                //man.set({name:''}, {'validate':true});  //手动触发验证, set时会触发
              //  man.save(); //save时触发验证。根据验证规则，弹出错误提示。


            })(jQuery)
        </script>
    </body>
</html>
